<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><title>Activity 生命周期和启动模式 | DONGYAN</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Activity 生命周期和启动模式</h1><a id="logo" href="/.">DONGYAN</a><p class="description">DO IT</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Activity 生命周期和启动模式</h1><div class="post-meta">2017-10-05<span> | </span><span class="category"><a href="/categories/Android/">Android</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity-角色浅析"><span class="toc-number">1.</span> <span class="toc-text">Activity 角色浅析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity-生命周期"><span class="toc-number">2.</span> <span class="toc-text">Activity 生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#任务和返回栈"><span class="toc-number">2.1.</span> <span class="toc-text">任务和返回栈</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Activity-存在状态"><span class="toc-number">2.2.</span> <span class="toc-text">Activity 存在状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Activity-的生存期"><span class="toc-number">2.3.</span> <span class="toc-text">Activity 的生存期</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Activity-启动模式"><span class="toc-number">3.</span> <span class="toc-text">Activity 启动模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#standard"><span class="toc-number">3.1.</span> <span class="toc-text">standard</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#singleTop"><span class="toc-number">3.2.</span> <span class="toc-text">singleTop</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#singleTask"><span class="toc-number">3.3.</span> <span class="toc-text">singleTask</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#singleInstance"><span class="toc-number">3.4.</span> <span class="toc-text">singleInstance</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#参考资料"><span class="toc-number">4.</span> <span class="toc-text">参考资料</span></a></li></ol></div></div><div class="post-content"><h3 id="Activity-角色浅析"><a href="#Activity-角色浅析" class="headerlink" title="Activity 角色浅析"></a>Activity 角色浅析</h3><p>在 Android 应用中，Activity 作为四大组件之一，扮演着举足轻重的角色。首先作为与用户的直接交互者，Activity 可以展示多种多样的内容，其次作为业务逻辑的主要处理单元，Activity 里包含着许多业务逻辑，在 Activity 中，通过 Intent 等途径和其他的 Activity 和组件进行信息交流，需要和展示较多的数据单元，和数据层有着较强的耦合性，不过在这里，会有例如 MVP、MVVM 等优秀的设计模式来优化界面和数据耦合性的问题，后续探讨，暂不细述。</p>
<p>Activity 是一个应用组件，可以充满屏幕也可以浮动于其他窗口之上，一般来讲，它是一个应用重要的组成部分，在开发中会指定一个“主要”的 Activity 作为程序的入口，而 Activity 在程序中则是存在于任务栈中，类似于栈的数据结构操作，Android 中提供了四种 Activity 的启动模式，分别为：standard （标准模式）、singleTop（栈顶复用）、singleTask（栈内复用）、singleInstance（单实例模式）。</p>
<p>Activity 继承自 android.view.ContextThemeWrapper, 所以在开发中会发现 Activity 是一个层级视图的对象，每个视图控制着 Activity 窗口内特定的矩形区域，并且可以对用户的交互做出相应。Activity 的层级视图可以由 XML 文件和 Java 共同控制，在 Activity 的生命周期中，调用 setContentView() 加载布局，也可以在 Activity 中通过 Java 代码创建新的 View，并通过将新的 View 插入到 ViewGroup 中来创建视图的层次，通过跟 ViewGroup 传递到 setContentView() 来使用该布局。</p>
<p>Activity 是一个可以玩出很多花样的组件，无论是炫酷和简约的 Android APP，只要你需要界面，那么 Activity 将是必须用到的东西，但是无论花样再多，其内在的核心是不变的，所以来探究一下其生命周期和启动模式。</p>
<a id="more"></a>

<h3 id="Activity-生命周期"><a href="#Activity-生命周期" class="headerlink" title="Activity 生命周期"></a>Activity 生命周期</h3><h4 id="任务和返回栈"><a href="#任务和返回栈" class="headerlink" title="任务和返回栈"></a>任务和返回栈</h4><p>应用中通常会有许多 Activity，最初的开发中，没有在程序中执行 finish() 方法来销毁 Activity，当多次点击启动新的 Activity 时，会导致启动的窗口堆积，查阅文档，发现 Android 所采用的活动管理方案是通过 Task（任务），一个任务就是一组存放在栈里的集合，这个栈也被称作<em>返回栈</em>（Back Stack）。在数据结构中，栈是一种先进后出结构，所以在默认的情况下，启动一个新的 Activity，它会在返回栈入栈，并处在栈顶的位置，当按下 Back 键时， 系统会执行 finish() 方法，从而栈顶元素出栈，前一个入栈的 Activity 就会出现在栈顶，系统会将栈顶的 Activity 展示在前台。<br><img src="/img/backstack.png" alt="backstack"></p>
<h4 id="Activity-存在状态"><a href="#Activity-存在状态" class="headerlink" title="Activity 存在状态"></a>Activity 存在状态</h4><p>每一个 Activity 在应用中的存在状态分为四种类型：运行、暂停、停止、销毁。四种状态可以和 Activity 的生命周期相对应起来。</p>
<ul>
<li>Activity 处于运行状态时，位于返回栈栈顶，系统一般不会回收正在运行的 Activity。</li>
<li>Activity 处于暂停状态时，其不再位于返回栈栈顶，但仍然处于可见状态，例如虽然不是当前 Activity，但是以对话框的形式存在。处于暂停状态下的 Activity 系统极少回去回收，除非在内存极低的情况下，否则不会回收处于暂停状态下的 Activity。</li>
<li>Activity 处于停止状态时，其不再处于返回栈栈顶，并且完全不可见，此时便处于停止状态。停止状态下系统仍然会保留相应的状态和成员变量，但是并不可靠，在某一些地方需要更多的内存时，停止状态下的 Activity 会被回收。</li>
<li>Activity 处于销毁状态时，从返回栈移除，这种状态下的 Activity 被系统回收的优先级最高。</li>
</ul>
<h4 id="Activity-的生存期"><a href="#Activity-的生存期" class="headerlink" title="Activity 的生存期"></a>Activity 的生存期</h4><p>Activity 中有七个回调方法，分别指向 Activity 生命周期的不同环节，同时也对应着不同的生存期，主要分为：完整生存期、可见生存期、前台生存期三种。<br>在 Android 的<a href="https://developer.android.com/guide/components/activities.html" target="_blank" rel="noopener">开发文档</a> 中，可以找到如下的生命周期图示：</p>
<p><img src="/img/activity_lifecycle.png" alt="activity_ligecycle"></p>
<p>从文档和图示中可以清晰的看到这七个回调方法：</p>
<ul>
<li>onCreate() 生命周期的第一个方法，执行 Activity 的创建、初始化操作</li>
<li>onStart() 启动 Activity，在 Activity 由不可见变为可见的时候调用</li>
<li>onResume() 在 Activity 做好和用户交互的情况下调用，表示已经可见，并且出现在了前台</li>
<li>onPause() Activity 正在停止，通常在系统准备启动或恢复另外一个 Activity 的时候启动，在该方法中经常会将一些消耗 CPU 的资源释放掉，或者保存一些关键的数据，不过该方法不能处理耗时操作，否则会影响新的 Activity 启动。</li>
<li>onStop() 一般在 onPause() 方法启动之后，用于在 Activity 完全不可见的时候调用，可以处理一些重的回收操作，但是同样不能太耗时。</li>
<li>onDestory() 在被销毁之前调用，在此可以做一些回收和最终的资源释放。</li>
<li>onReStart() 在 Activity 由停止状态到运行状态之前调用，重新启动 Activity。</li>
</ul>
<p>Activity 的七个回调方法，除了 onRestart() 方法之外，均是两两相对，据此将生命周期分为三个阶段，分别为：</p>
<ul>
<li><strong>完整生存期</strong><br>在 onCreate() 和 onDestroy() 方法之间所经历的，为完整的生存期。<br>囊括整个 Activity 的创建到销毁的过程。</li>
<li><strong>可见生存期</strong><br>从 onStart() 到 onStop() 之间的生存阶段，在可见生存期内， Activity 处于可见状态，即便有可能无法与用户交互，通过这两个方法，合理的处理用户可见的资源，比如在 onStart() 方法中加载资源，在 onStop() 中释放，从而使在停止阶段的 Activity 不至于占用过多的内存。</li>
<li><strong>前台生存期</strong><br>在 onResume() 和 onPause() 方法之间，活动处于运行状态，并且可以和用户交互，这种状态的 Activity 日常中接触的最多，</li>
</ul>
<p>关于 Activity 生命周期的问题，很多都可以通过查看源码解决，比如在 Activity A 中打开一个新的窗口 B，那么 B 中的 onResume 和 A 中的 onPause 哪个最先执行的，在查阅源码中的 ActivityStack.java 文件中的 resumeTopActivityInnerLocked 方法后可以看出：在新的 Activity 启动之前，栈顶的 Activity 需要先 onPause 后，新的 Activity 才会启动……</p>
<p>等等。</p>
<p>另外，在异常情况下的时候，Activity 的生命周期会有所不同，但是在 Activity 中均有对应的方法来保存数据和状态，从而具体情况要具体分析，通过解决一个又一个的问题才能对整个的生命周期掌握的熟练和细致。</p>
<h3 id="Activity-启动模式"><a href="#Activity-启动模式" class="headerlink" title="Activity 启动模式"></a>Activity 启动模式</h3><h4 id="standard"><a href="#standard" class="headerlink" title="standard"></a>standard</h4><p>默认启动模式，每次打开 Activity 均会创建一个 Activity 实例放到栈中，无论这个实例是否存在，均会创建。<br>生命周期中的 onCreate、onStart、onResume 方法均会正常调用。</p>
<h4 id="singleTop"><a href="#singleTop" class="headerlink" title="singleTop"></a>singleTop</h4><p>栈顶复用模式，在这种模式下，若新的 Activity 位于栈顶，那么 Activity 将不会被重新创建，同时回调它的 onNewIntent 方法，通过方法参数取出当前的请求信息，同时 onCreate、onStart 方法将不会调用，若新的 Activity 不位于栈顶，则新的 Activity 仍然会重建。</p>
<h4 id="singleTask"><a href="#singleTask" class="headerlink" title="singleTask"></a>singleTask</h4><p>栈内复用模式。这是一种单实例模式，在这种模式下，只要 Activity 在一个栈中存在，那么多次启动此 Activity 均不会创建新的实例，类似上述的 singleTop，系统会调用 onNewIntent 方法。在该模式下的 Activity，系统会首先寻找是否存在该 Activity 想要的返回栈，如果没有则创建将其放入，如果存在则看该 Activity 是否存在于，不存在则创建，存在则调用 onNewIntent 方法。</p>
<h4 id="singleInstance"><a href="#singleInstance" class="headerlink" title="singleInstance"></a>singleInstance</h4><p>单实例模式。有人称之为加强风的 singleTask 模式，除了具有 singleTask 的所有特性外，加强了一个点，就是具有此模式的 Activity 只能单独的存在于一个任务栈中，当其启动时候，系统会创建一个新的任务栈，然后独立的运行在这里，由于栈内复用的特性，后续的不会创建新的 Activity，直到该任务栈被销毁。</p>
<p>关于启动模式，开发中没有用到的实例，所以不敢多纸上谈兵，仅此。</p>
<h3 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h3><p> Android API 文档<br>《Android 开发艺术探索》<br>《第一行代码》</p>
</div><div class="tags"><a href="/tags/Android/"><i class="fa fa-tag"></i>Android</a><a href="/tags/Activity/"><i class="fa fa-tag"></i>Activity</a></div><div class="post-nav"><a class="pre" href="/2017/11/02/Android-ReadDaily/">开源：基于 MVP+Retrofit+RxJava+Jsoup+Glide+Material Design 的 Android 阅读应用</a><a class="next" href="/2017/09/28/android_system-start_and_app-start/">Android 系统及应用启动流程</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://zhaidongyan.cn"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Emotion/">Emotion</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Security/">Security</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Technology/">Technology</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Translate/">Translate</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/android/" style="font-size: 15px;">android</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a> <a href="/tags/DOIT/" style="font-size: 15px;">DOIT</a> <a href="/tags/diary/" style="font-size: 15px;">diary</a> <a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/Sec/" style="font-size: 15px;">Sec</a> <a href="/tags/MVC/" style="font-size: 15px;">MVC</a> <a href="/tags/MVP/" style="font-size: 15px;">MVP</a> <a href="/tags/Alpha-beta/" style="font-size: 15px;">Alpha-beta</a> <a href="/tags/Activity/" style="font-size: 15px;">Activity</a> <a href="/tags/diary%EF%BC%8CShenZhen/" style="font-size: 15px;">diary，ShenZhen</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/Stability/" style="font-size: 15px;">Stability</a> <a href="/tags/PHP/" style="font-size: 15px;">PHP</a> <a href="/tags/RegEx/" style="font-size: 15px;">RegEx</a> <a href="/tags/RxJava/" style="font-size: 15px;">RxJava</a> <a href="/tags/%E7%B3%BB%E7%BB%9F%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/" style="font-size: 15px;">系统启动流程</a> <a href="/tags/Flutter/" style="font-size: 15px;">Flutter</a> <a href="/tags/View/" style="font-size: 15px;">View</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/11/22/Sec.Android:begin/">移动安全--开篇</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/09/23/Thinking%20about%20goals/">关于目标的一点点思考</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/08/28/DO%20IT/">DO IT ZDY</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/07/translate_flutter-5-reasons-why-you-may-love-it/">【译】Flutter — 五个你会爱上它的原因</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/03/01/translate_confusion-subject-observable-observer-android-rxjava2-hell-part8/">【译】Subject 和 Observable + Observer 的混淆指北[ Android RxJava2 ] ( 这什么鬼系列 ) 第八话</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/10/Java_JVM_classloader/">Java 虚拟机类加载机制</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/05/Java_reference/">Java 引用类型分析与总结</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/04/Java_input_output_stream/">Java 输入输出流</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/02/03/Java_data%20structure_Hashmap/">Java 数据结构实现原理之 HashMap</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/01/21/Java_data%20structure_ArrayList/">Java 数据结构实现原理之 ArrayList</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">DONGYAN.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>